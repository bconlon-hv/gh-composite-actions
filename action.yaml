name:  Pull Request Workflow template
description: "Composite Action Template For Pull Request"
inputs:
  image_name:
    required: false
  command:
    required: true
  workdir:
    required: true

runs:
  using: "composite"
  steps:
      
    - name: Run command in container
      if: ${{ github.event.inputs.image_name != '' }}
      run: |
        docker run --workdir /github/workspace -v "/var/run/docker.sock":"/var/run/docker.sock" -v "${{ inputs.workdir }}":"/github/workspace" ${{ inputs.image_name }} ${{ inputs.command }}
      shell: bash
      
    - name: Run command
      if: ${{ github.event.inputs.image_name == '' }}
      run: ${{ inputs.command }}
      shell: bash
      
    - name: Sonar scan
      if: ${{ env.sonar_commands }}
      uses: lumada-common-services/gh-composite-actions@sonar-action
      
      
    - name: OWASP Scan
      if: ${{ env.owasp_Project }}
      uses: dependency-check/Dependency-Check_Action@main
      id: owasp
      with:
        project: ${{ env.owasp_Project }}        
        comand: >
             pwd
        path: '.'
        format: 'ALL'
        out: 'reports'
        args: >
            --exclude ./*.zip \
            --exclude ./*.tar \
            --exclude ./*.gz \
            --exclude ./*.war \
            --disableNodeJS \
            --disableAssembly \
            --disableYarnAudit \
            --enableRetired
      
    - name: Create tag
      if: ${{ env.Tag_version }}
      uses: actions/github-script@v5
      with:
        script: |
            github.rest.git.createRef({
              owner: context.repo.owner,
              repo: context.repo.repo,
              ref: 'refs/tags/${{ env.Tag_version }}',
              sha: context.sha
            })
